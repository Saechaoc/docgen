{% if metadata.flow_summary %}
### High-Level Flow

{{ metadata.flow_summary }}

{% if metadata.flow_diagram %}
```mermaid
{{ metadata.flow_diagram }}
```
{% endif %}
{% endif %}

{% if metadata.components %}
### Component Responsibilities

| Layer | Key modules | Purpose |
| --- | --- | --- |
{% for entry in metadata.components %}| {{ entry.layer }} | {{ entry.modules | join(', ') }} | {{ entry.purpose }} |
{% endfor %}
{% endif %}

{% if metadata.module_overview %}
### Repository Layout Snapshot

| Path | Roles | File count |
| --- | --- | --- |
{% for entry in metadata.module_overview %}| {{ entry.name }} | {{ entry.roles | join(', ') }} | {{ entry.files }} |
{% endfor %}
{% endif %}

{% if metadata.artifacts %}
### Artifacts and Data Stores

{% for artifact in metadata.artifacts %}- `{{ artifact.path }}` - {{ artifact.description }}
{% endfor %}
{% endif %}

{% if metadata.init_sequence %}
### Pipeline Sequence (`docgen init`)

```mermaid
{{ metadata.init_sequence }}
```
{% endif %}

{% if metadata.update_sequence %}
### Patch Sequence (`docgen update`)

```mermaid
{{ metadata.update_sequence }}
```
{% endif %}

{% if metadata.api_diagram %}
### API Signal Extraction

```mermaid
{{ metadata.api_diagram }}
```
{% endif %}

{% if metadata.entities_markdown %}
### Detected Entities

{{ metadata.entities_markdown }}
{% elif metadata.entities %}
### Detected Entities

{% for entity in metadata.entities %}
- {{ entity.name }}{% if entity.bases %} ({{ entity.bases | join(', ') }}){% endif %}{% if entity.file %} - `{{ entity.file }}`{% endif %}
{% endfor %}
{% endif %}

{% if metadata.context_markdown %}
### Context Highlights

{{ metadata.context_markdown }}
{% elif metadata.context %}
### Context Highlights

{% for snippet in metadata.context %}
- {{ snippet }}
{% endfor %}
{% endif %}

{% if not (metadata.flow_summary or metadata.components or metadata.module_overview or metadata.artifacts or metadata.init_sequence or metadata.update_sequence or metadata.api_diagram or metadata.entities) %}
{{ body | trim | safe }}
{% endif %}

