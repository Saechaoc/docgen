{% if metadata.flow_summary %}
### High-Level Flow

{{ metadata.flow_summary }}
{% endif %}

{% if metadata.entries %}
### Component Responsibilities

| Module | Roles | Files |
| --- | --- | --- |
{% for entry in metadata.entries %}{% set roles = entry.roles if entry.roles is defined else entry.description %}{% if roles is undefined %}{% set roles = 'Project files' %}{% endif %}| {{ entry.name if entry.name is defined else entry.path }} | {% if roles is string %}{{ roles }}{% elif roles is iterable %}{{ roles|join(', ') }}{% else %}{{ roles }}{% endif %} | {{ entry.files if entry.files is defined else entry.count if entry.count is defined else 0 }} |
{% endfor %}
{% endif %}

{% if metadata.artifacts %}
### Artifacts and Data Stores

{% for artifact in metadata.artifacts %}- {{ artifact.path }} - {{ artifact.description }}
{% endfor %}
{% endif %}

{% if metadata.init_sequence %}
### Pipeline Sequence (docgen init)

`mermaid
{{ metadata.init_sequence }}
`
{% endif %}

{% if metadata.update_sequence %}
### Patch Sequence (docgen update)

`mermaid
{{ metadata.update_sequence }}
`
{% endif %}

{% if metadata.diagram %}
### API Signal Extraction

`mermaid
{{ metadata.diagram }}
`
{% endif %}

{% if metadata.entities %}
### Detected Entities

{% for entity in metadata.entities %}- {{ entity.name }}{% if entity.bases %} ({{ entity.bases|join(', ') }}){% endif %}{% if entity.file %} - {{ entity.file }}{% endif %}
{% endfor %}
{% endif %}

{% if not (metadata.flow_summary or metadata.entries or metadata.init_sequence or metadata.update_sequence or metadata.diagram or metadata.artifacts or metadata.entities) %}
{{ body | trim | safe }}
{% endif %}
